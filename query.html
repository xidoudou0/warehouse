<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>仓库物资查询系统</title>
    <style>
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        #keyword {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        #search-btn {
            padding: 12px 25px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        #search-btn:hover {
            background-color: #3367d6;
        }
        #result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        #result-table th, #result-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        #result-table th {
            background-color: #f0f0f0;
            font-weight: bold;
            color: #555;
        }
        #result-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .empty-message {
            color: #777;
            text-align: center;
            padding: 30px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>仓库物资库存查询</h1>
        <div class="search-bar">
            <input type="text" id="keyword" placeholder="请输入物资编码或描述（例如：001 或 电源）">
            <button id="search-btn" onclick="search()">查询</button>
        </div>
        <table id="result-table"></table>
    </div>

    <script>
        // 存储解析后的库存数据
        let inventoryData = [];
        // 请替换为你的 inventory.csv 的 Raw 链接（必须是 raw.githubusercontent.com 开头）
        const csvUrl = "https://raw.githubusercontent.com/xidoudou0.github.io/warehouse/main/inventory.csv";

        // 页面加载时加载 CSV 数据
        window.onload = function() {
            loadCsvData();
        };

        // 加载并解析 CSV 数据
        function loadCsvData() {
            fetch(csvUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("数据加载失败，请检查 CSV 链接是否正确");
                    }
                    return response.text();
                })
                .then(csvText => {
                    inventoryData = parseCsv(csvText);
                })
                .catch(error => {
                    document.getElementById("result-table").innerHTML = 
                        `<tr><td class="empty-message" colspan="4">${error.message}</td></tr>`;
                });
        }

        // 解析 CSV 文本为对象数组（匹配你的表头顺序）
        function parseCsv(csvText) {
            // 按行分割 CSV 内容，过滤空行
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            if (lines.length === 0) {
                throw new Error("CSV 文件为空，请检查数据");
            }

            // 解析表头（第一行），去除可能的双引号和空格
            const headers = lines[0]
                .replace(/"/g, '') // 去除双引号
                .split(',')
                .map(header => header.trim()); // 去除首尾空格

            // 验证表头是否包含必要字段（与你的 CSV 表头一致）
            const requiredHeaders = ['物资编码', '物资描述', '数量', '货架号'];
            const missingHeaders = requiredHeaders.filter(h => !headers.includes(h));
            if (missingHeaders.length > 0) {
                throw new Error(`CSV 表头缺失必要字段：${missingHeaders.join('、')}`);
            }

            // 解析数据行（从第二行开始）
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i]
                    .replace(/"/g, '') // 去除双引号
                    .split(',')
                    .map(value => value.trim()); // 去除首尾空格

                // 将数据映射为对象（键：表头，值：对应的数据）
                const item = {};
                headers.forEach((header, index) => {
                    item[header] = values[index] || ''; // 若值为空，显示空字符串
                });
                data.push(item);
            }
            return data;
        }

        // 执行查询逻辑
        function search() {
            const keyword = document.getElementById("keyword").value.trim().toLowerCase();
            const resultTable = document.getElementById("result-table");
            resultTable.innerHTML = ''; // 清空历史结果

            // 验证输入
            if (keyword === '') {
                resultTable.innerHTML = 
                    `<tr><td class="empty-message" colspan="4">请输入物资编码或描述</td></tr>`;
                return;
            }

            // 筛选匹配结果（编码精确匹配，描述模糊匹配）
            const matchedResults = inventoryData.filter(item => {
                const codeMatch = item['物资编码'].toLowerCase() === keyword;
                const descMatch = item['物资描述'].toLowerCase().includes(keyword);
                return codeMatch || descMatch;
            });

            // 显示结果
            if (matchedResults.length === 0) {
                resultTable.innerHTML = 
                    `<tr><td class="empty-message" colspan="4">未找到匹配的物资信息</td></tr>`;
                return;
            }

            // 生成表头（严格匹配你的 CSV 表头顺序：物资编码 → 物资描述 → 数量 → 货架号）
            const headerOrder = ['物资编码', '物资描述', '数量', '货架号'];
            let tableHtml = '<tr>';
            headerOrder.forEach(header => {
                tableHtml += `<th>${header}</th>`;
            });
            tableHtml += '</tr>';

            // 生成数据行（按表头顺序对应字段）
            matchedResults.forEach(item => {
                tableHtml += '<tr>';
                headerOrder.forEach(header => {
                    tableHtml += `<td>${item[header]}</td>`;
                });
                tableHtml += '</tr>';
            });

            resultTable.innerHTML = tableHtml;
        }

        // 支持回车键查询
        document.getElementById("keyword").addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                search();
            }
        });
    </script>
</body>
</html>