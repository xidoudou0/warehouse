<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>仓库物资查询</title>
    <style>
        body { font-family: "Microsoft YaHei"; max-width: 700px; margin: 0 auto; padding: 20px; }
        .search-box { margin: 30px 0; text-align: center; }
        #keyword { width: 60%; padding: 12px; font-size: 16px; border: 2px solid #ccc; border-radius: 4px; }
        button { padding: 12px 24px; margin-left: 10px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        #result { width: 100%; border-collapse: collapse; margin-top: 20px; }
        #result th, #result td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        #result th { background-color: #f5f5f5; font-weight: bold; }
        .empty { color: #777; text-align: center; padding: 20px; }
    </style>
</head>
<body>
    <h2 style="text-align: center;">仓库物资库存查询</h2>
    <div class="search-box">
        <input type="text" id="keyword" placeholder="请输入物资编码或描述（例如：001 或 鼠标）">
        <button onclick="search()">查询</button>
    </div>
    <table id="result"></table>

    <script>
        let inventoryData = [];
        // 替换为你的 GitHub 仓库中 inventory.csv 的 raw 链接
        const csvUrl = "https://raw.githubusercontent.com/xidoudou0/warehouse/main/inventory.csv";

        // 页面加载时读取 CSV 数据
        window.onload = function() {
            fetch(csvUrl)
                .then(response => {
                    if (!response.ok) throw new Error("数据加载失败");
                    return response.text();
                })
                .then(text => {
                    inventoryData = parseCsv(text); // 解析 CSV 为数组
                })
                .catch(error => {
                    document.getElementById("result").innerHTML = `<tr><td class="empty">${error.message}</td></tr>`;
                });
        };

        // 解析 CSV 文本为对象数组（处理中文和引号）
        function parseCsv(text) {
            const lines = text.split('\n').filter(line => line.trim() !== ''); // 去除空行
            if (lines.length === 0) return [];
            
            // 提取表头（去除双引号，处理可能的空格）
            const headers = lines[0].replace(/"/g, '').split(',').map(h => h.trim());
            const data = [];
            
            // 解析每行数据
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].replace(/"/g, '').split(',').map(v => v.trim());
                const item = {};
                headers.forEach((header, index) => {
                    item[header] = values[index] || ''; // 映射表头与值
                });
                data.push(item);
            }
            return data;
        }

        // 查询功能实现
        function search() {
            const keyword = document.getElementById("keyword").value.trim().toLowerCase();
            const resultTable = document.getElementById("result");
            resultTable.innerHTML = ''; // 清空历史结果

            if (!keyword) {
                resultTable.innerHTML = '<tr><td class="empty">请输入查询内容</td></tr>';
                return;
            }

            // 筛选匹配结果（编码精确匹配，描述模糊匹配）
            const results = inventoryData.filter(item => {
                const codeMatch = item['物资编码'].toLowerCase() === keyword;
                const descMatch = item['物资描述'].toLowerCase().includes(keyword);
                return codeMatch || descMatch;
            });

            // 显示查询结果
            if (results.length === 0) {
                resultTable.innerHTML = '<tr><td class="empty">未找到匹配的物资</td></tr>';
                return;
            }

            // 生成表头
            let headerRow = '<tr>';
            Object.keys(results[0]).forEach(key => {
                headerRow += `<th>${key}</th>`;
            });
            headerRow += '</tr>';
            resultTable.innerHTML += headerRow;

            // 生成数据行
            results.forEach(item => {
                let dataRow = '<tr>';
                Object.values(item).forEach(value => {
                    dataRow += `<td>${value}</td>`;
                });
                dataRow += '</tr>';
                resultTable.innerHTML += dataRow;
            });
        }

        // 支持回车键查询
        document.getElementById("keyword").addEventListener('keypress', function(e) {
            if (e.key === 'Enter') search();
        });
    </script>
</body>
</html>